// -------------------------------------------------------------
// 
// File Name: hdl_prj/hdlsrc/wlanhdlTimeAndFrequencySynchronization/Peak_Detector.v
// Created: 2026-02-04 22:38:43
// 
// Generated by MATLAB 25.1, HDL Coder 25.1, and Simulink 25.1
// 
// -------------------------------------------------------------


// -------------------------------------------------------------
// 
// Module: Peak_Detector
// Source Path: wlanhdlTimeAndFrequencySynchronization/WLANTimeAndFrequencySynchronization/Coarse Time Sync/Peak 
// Detecto
// Hierarchy Level: 2
// Model version: 9.2
// 
// -------------------------------------------------------------

`timescale 1 ns / 1 ns

module Peak_Detector
          (clk,
           reset,
           enb_1_8_1,
           enb_1_8_0,
           enb,
           corrIn,
           energyIn,
           corrValid,
           dataIn_re,
           dataIn_im,
           dataValid,
           lstfStart,
           validOut,
           dataOut_re,
           dataOut_im);


  input   clk;
  input   reset;
  input   enb_1_8_1;
  input   enb_1_8_0;
  input   enb;
  input   signed [65:0] corrIn;  // sfix66_En52
  input   signed [70:0] energyIn;  // sfix71_En54
  input   corrValid;
  input   signed [15:0] dataIn_re;  // sfix16_En12
  input   signed [15:0] dataIn_im;  // sfix16_En12
  input   dataValid;
  output  lstfStart;
  output  validOut;
  output  signed [15:0] dataOut_re;  // sfix16_En12
  output  signed [15:0] dataOut_im;  // sfix16_En12


  wire signed [70:0] Relational_Operator_cast;  // sfix71_En54
  wire Relational_Operator_out1;
  wire syncOut;
  wire considerFirstPeak_peakOut;
  wire considerFirstPeak_validOut;
  reg  [159:0] Delay1_reg;  // ufix1 [160]
  wire Delay1_out1;
  wire Delay1_out1_1;
  wire Logical_Operator3_out1;
  reg  MATLAB_Function13_bypass_reg;  // ufix1
  wire Logical_Operator3_out1_1;
  reg signed [15:0] Delay2_reg_re [0:159];  // sfix16_En12 [160]
  reg signed [15:0] Delay2_reg_im [0:159];  // sfix16_En12 [160]
  reg signed [15:0] Delay2_reg_next_re [0:159];  // sfix16_En12 [160]
  reg signed [15:0] Delay2_reg_next_im [0:159];  // sfix16_En12 [160]
  reg signed [15:0] Delay2_out1_re;  // sfix16_En12
  reg signed [15:0] Delay2_out1_im;  // sfix16_En12
  wire signed [15:0] Delay2_out1_re_1;  // sfix16_En12
  wire signed [15:0] Delay2_out1_im_1;  // sfix16_En12
  reg signed [15:0] MATLAB_Function11_bypass_reg_re;  // sfix16_En12
  reg signed [15:0] MATLAB_Function11_bypass_reg_im;  // sfix16_En12
  wire signed [15:0] Delay2_out1_re_2;  // sfix16_En12
  wire signed [15:0] Delay2_out1_im_2;  // sfix16_En12
  reg  MATLAB_Function12_bypass_reg;  // ufix1
  wire Delay1_out1_2;
  reg signed [31:0] Delay2_t_0_0;  // int32
  reg signed [31:0] Delay2_t_0_1;  // int32
  reg signed [31:0] Delay2_t_1;  // int32

  // Searching peak in LSTF region


  assign Relational_Operator_cast = {{3{corrIn[65]}}, {corrIn, 2'b00}};
  assign Relational_Operator_out1 = Relational_Operator_cast > energyIn;

  searchStartOfFrame u_searchStartOfFrame (.clk(clk),
                                           .reset(reset),
                                           .enb_1_8_0(enb_1_8_0),
                                           .thresholdValid(Relational_Operator_out1),
                                           .valid(corrValid),
                                           .syncOut(syncOut)
                                           );

  considerFirstPeak u_considerFirstPeak (.clk(clk),
                                         .reset(reset),
                                         .enb_1_8_1(enb_1_8_1),
                                         .enb(enb),
                                         .peakIn(syncOut),
                                         .peakOut(considerFirstPeak_peakOut),
                                         .validOut(considerFirstPeak_validOut)
                                         );

  assign lstfStart = considerFirstPeak_peakOut;

  always @(posedge clk or posedge reset)
    begin : Delay1_process
      if (reset == 1'b1) begin
        Delay1_reg <= {160{1'b0}};
      end
      else begin
        if (enb_1_8_0) begin
          Delay1_reg[0] <= dataValid;
          Delay1_reg[32'sd159:32'sd1] <= Delay1_reg[32'sd158:32'sd0];
        end
      end
    end

  assign Delay1_out1 = Delay1_reg[159];

  assign Delay1_out1_1 = Delay1_out1;

  assign Logical_Operator3_out1 = considerFirstPeak_validOut & Delay1_out1_1;

  assign validOut = Logical_Operator3_out1;

  always @(posedge clk or posedge reset)
    begin : MATLAB_Function13_bypass_process
      if (reset == 1'b1) begin
        MATLAB_Function13_bypass_reg <= 1'b0;
      end
      else begin
        if (enb_1_8_1) begin
          MATLAB_Function13_bypass_reg <= Logical_Operator3_out1;
        end
      end
    end

  assign Logical_Operator3_out1_1 = (enb_1_8_1 == 1'b1 ? Logical_Operator3_out1 :
              MATLAB_Function13_bypass_reg);

  always @(posedge clk or posedge reset)
    begin : Delay2_process
      if (reset == 1'b1) begin
        for(Delay2_t_1 = 32'sd0; Delay2_t_1 <= 32'sd159; Delay2_t_1 = Delay2_t_1 + 32'sd1) begin
          Delay2_reg_re[Delay2_t_1] <= 16'sb0000000000000000;
          Delay2_reg_im[Delay2_t_1] <= 16'sb0000000000000000;
        end
      end
      else begin
        if (enb_1_8_0) begin
          for(Delay2_t_0_1 = 32'sd0; Delay2_t_0_1 <= 32'sd159; Delay2_t_0_1 = Delay2_t_0_1 + 32'sd1) begin
            Delay2_reg_re[Delay2_t_0_1] <= Delay2_reg_next_re[Delay2_t_0_1];
            Delay2_reg_im[Delay2_t_0_1] <= Delay2_reg_next_im[Delay2_t_0_1];
          end
        end
      end
    end

  always @* begin
    Delay2_out1_re = Delay2_reg_re[159];
    Delay2_out1_im = Delay2_reg_im[159];
    Delay2_reg_next_re[0] = dataIn_re;
    Delay2_reg_next_im[0] = dataIn_im;

    for(Delay2_t_0_0 = 32'sd0; Delay2_t_0_0 <= 32'sd158; Delay2_t_0_0 = Delay2_t_0_0 + 32'sd1) begin
      Delay2_reg_next_re[Delay2_t_0_0 + 32'sd1] = Delay2_reg_re[Delay2_t_0_0];
      Delay2_reg_next_im[Delay2_t_0_0 + 32'sd1] = Delay2_reg_im[Delay2_t_0_0];
    end

  end

  assign Delay2_out1_re_1 = Delay2_out1_re;

  assign Delay2_out1_im_1 = Delay2_out1_im;

  always @(posedge clk or posedge reset)
    begin : MATLAB_Function11_bypass_process
      if (reset == 1'b1) begin
        MATLAB_Function11_bypass_reg_re <= 16'sb0000000000000000;
        MATLAB_Function11_bypass_reg_im <= 16'sb0000000000000000;
      end
      else begin
        if (enb_1_8_1) begin
          MATLAB_Function11_bypass_reg_im <= Delay2_out1_im_1;
          MATLAB_Function11_bypass_reg_re <= Delay2_out1_re_1;
        end
      end
    end

  assign Delay2_out1_re_2 = (enb_1_8_1 == 1'b1 ? Delay2_out1_re_1 :
              MATLAB_Function11_bypass_reg_re);
  assign Delay2_out1_im_2 = (enb_1_8_1 == 1'b1 ? Delay2_out1_im_1 :
              MATLAB_Function11_bypass_reg_im);

  always @(posedge clk or posedge reset)
    begin : MATLAB_Function12_bypass_process
      if (reset == 1'b1) begin
        MATLAB_Function12_bypass_reg <= 1'b0;
      end
      else begin
        if (enb_1_8_1) begin
          MATLAB_Function12_bypass_reg <= Delay1_out1_1;
        end
      end
    end

  assign Delay1_out1_2 = (enb_1_8_1 == 1'b1 ? Delay1_out1_1 :
              MATLAB_Function12_bypass_reg);

  MATLAB_Function1 u_MATLAB_Function1 (.syncEn(Logical_Operator3_out1_1),
                                       .dataIn_re(Delay2_out1_re_2),  // sfix16_En12
                                       .dataIn_im(Delay2_out1_im_2),  // sfix16_En12
                                       .validIn(Delay1_out1_2),
                                       .dataOut_re(dataOut_re),  // sfix16_En12
                                       .dataOut_im(dataOut_im)  // sfix16_En12
                                       );

endmodule  // Peak_Detector

