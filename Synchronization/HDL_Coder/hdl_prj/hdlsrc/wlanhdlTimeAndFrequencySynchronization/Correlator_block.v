// -------------------------------------------------------------
// 
// File Name: hdl_prj/hdlsrc/wlanhdlTimeAndFrequencySynchronization/Correlator_block.v
// Created: 2026-02-04 22:38:43
// 
// Generated by MATLAB 25.1, HDL Coder 25.1, and Simulink 25.1
// 
// -------------------------------------------------------------


// -------------------------------------------------------------
// 
// Module: Correlator_block
// Source Path: wlanhdlTimeAndFrequencySynchronization/WLANTimeAndFrequencySynchronization/Coarse Time Sync/Correlator
// Hierarchy Level: 2
// Model version: 9.2
// 
// -------------------------------------------------------------

`timescale 1 ns / 1 ns

module Correlator_block
          (clk,
           reset,
           enb_1_8_1,
           enb_1_8_0,
           enb,
           dataIn_re,
           dataIn_im,
           validIn,
           startIn,
           dataOut,
           validOut);


  input   clk;
  input   reset;
  input   enb_1_8_1;
  input   enb_1_8_0;
  input   enb;
  input   signed [15:0] dataIn_re;  // sfix16_En12
  input   signed [15:0] dataIn_im;  // sfix16_En12
  input   validIn;
  input   startIn;
  output  signed [65:0] dataOut;  // sfix66_En52
  output  validOut;


  wire signed [31:0] out_re;  // sfix32_En26
  wire signed [31:0] out_im;  // sfix32_En26
  wire delayedCorrelation_corrValid;
  wire delayedCorrelation_startOut;
  reg signed [31:0] Delay1_out1_re;  // sfix32_En26
  reg signed [31:0] Delay1_out1_im;  // sfix32_En26
  reg  Delay4_out1;
  reg  Delay5_out1;
  wire signed [32:0] MovingSum_dataOut_re;  // sfix33_En26
  wire signed [32:0] MovingSum_dataOut_im;  // sfix33_En26
  wire MovingSum_validOut;
  reg  [14:0] Delay2_reg;  // ufix1 [15]
  wire Delay2_out1;
  wire Delay2_out1_1;
  reg  Delay2_out1_2;
  wire MovingSum_validOut_1;
  reg  MovingSum_validOut_2;
  wire Logical_Operator_out1;
  reg  Logical_Operator_out1_1;
  wire switch_compare_1;
  wire signed [32:0] Constant_out1_re;  // sfix33_En26
  wire signed [32:0] Constant_out1_im;  // sfix33_En26
  wire signed [32:0] MovingSum_dataOut_re_1;  // sfix33_En26
  wire signed [32:0] MovingSum_dataOut_im_1;  // sfix33_En26
  reg signed [32:0] rd_2_reg_re [0:1];  // sfix33_En26 [2]
  reg signed [32:0] rd_2_reg_im [0:1];  // sfix33_En26 [2]
  wire signed [32:0] rd_2_reg_next_re [0:1];  // sfix33_En26 [2]
  wire signed [32:0] rd_2_reg_next_im [0:1];  // sfix33_En26 [2]
  wire signed [32:0] MovingSum_dataOut_re_2;  // sfix33_En26
  wire signed [32:0] MovingSum_dataOut_im_2;  // sfix33_En26
  wire signed [32:0] Switch_out1_re;  // sfix33_En26
  wire signed [32:0] Switch_out1_im;  // sfix33_En26
  reg signed [32:0] Switch_out1_re_1;  // sfix33_En26
  reg signed [32:0] Switch_out1_im_1;  // sfix33_En26
  wire signed [32:0] Shift_Arithmetic_out1_re;  // sfix33_En26
  wire signed [32:0] Shift_Arithmetic_out1_im;  // sfix33_En26
  wire signed [65:0] MagnitudeSquared_dataOut;  // sfix66_En52
  wire MagnitudeSquared_validOut;
  reg signed [65:0] MagnitudeSquared_dataOut_1;  // sfix66_En52
  reg signed [65:0] MagnitudeSquared_dataOut_2;  // sfix66_En52
  reg signed [65:0] Delay_out1;  // sfix66_En52
  wire MagnitudeSquared_validOut_1;
  reg  MagnitudeSquared_validOut_2;
  reg  [1:0] Delay3_reg;  // ufix1 [2]
  wire Delay3_out1;
  reg signed [31:0] rd_2_t_0_0;  // int32
  reg signed [31:0] rd_2_t_1;  // int32


  delayedCorrelation u_delayedCorrelation (.clk(clk),
                                           .reset(reset),
                                           .enb_1_8_1(enb_1_8_1),
                                           .enb_1_8_0(enb_1_8_0),
                                           .enb(enb),
                                           .dataIn_re(dataIn_re),  // sfix16_En12
                                           .dataIn_im(dataIn_im),  // sfix16_En12
                                           .validIn(validIn),
                                           .startIn(startIn),
                                           .corrOut_re(out_re),  // sfix32_En26
                                           .corrOut_im(out_im),  // sfix32_En26
                                           .corrValid(delayedCorrelation_corrValid),
                                           .startOut(delayedCorrelation_startOut)
                                           );

  always @(posedge clk or posedge reset)
    begin : Delay11_process
      if (reset == 1'b1) begin
        Delay1_out1_re <= 32'sb00000000000000000000000000000000;
        Delay1_out1_im <= 32'sb00000000000000000000000000000000;
      end
      else begin
        if (enb_1_8_0) begin
          Delay1_out1_re <= out_re;
          Delay1_out1_im <= out_im;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay4_process
      if (reset == 1'b1) begin
        Delay4_out1 <= 1'b0;
      end
      else begin
        if (enb_1_8_0) begin
          Delay4_out1 <= delayedCorrelation_corrValid;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay5_process
      if (reset == 1'b1) begin
        Delay5_out1 <= 1'b0;
      end
      else begin
        if (enb_1_8_0) begin
          Delay5_out1 <= delayedCorrelation_startOut;
        end
      end
    end

  MovingSum u_MovingSum (.clk(clk),
                         .reset(reset),
                         .enb_1_8_1(enb_1_8_1),
                         .enb_1_8_0(enb_1_8_0),
                         .enb(enb),
                         .dataIn_re(Delay1_out1_re),  // sfix32_En26
                         .dataIn_im(Delay1_out1_im),  // sfix32_En26
                         .validIn(Delay4_out1),
                         .reset_1(Delay5_out1),
                         .dataOut_re(MovingSum_dataOut_re),  // sfix33_En26
                         .dataOut_im(MovingSum_dataOut_im),  // sfix33_En26
                         .validOut(MovingSum_validOut)
                         );

  always @(posedge clk or posedge reset)
    begin : Delay2_process
      if (reset == 1'b1) begin
        Delay2_reg <= {15{1'b0}};
      end
      else begin
        if (enb_1_8_0) begin
          Delay2_reg[0] <= MovingSum_validOut;
          Delay2_reg[32'sd14:32'sd1] <= Delay2_reg[32'sd13:32'sd0];
        end
      end
    end

  assign Delay2_out1 = Delay2_reg[14];

  assign Delay2_out1_1 = Delay2_out1;

  always @(posedge clk or posedge reset)
    begin : rd_0_process
      if (reset == 1'b1) begin
        Delay2_out1_2 <= 1'b0;
      end
      else begin
        if (enb) begin
          Delay2_out1_2 <= Delay2_out1_1;
        end
      end
    end

  assign MovingSum_validOut_1 = MovingSum_validOut;

  always @(posedge clk or posedge reset)
    begin : rd_1_process
      if (reset == 1'b1) begin
        MovingSum_validOut_2 <= 1'b0;
      end
      else begin
        if (enb) begin
          MovingSum_validOut_2 <= MovingSum_validOut_1;
        end
      end
    end

  assign Logical_Operator_out1 = Delay2_out1_2 & MovingSum_validOut_2;

  always @(posedge clk or posedge reset)
    begin : rd_3_process
      if (reset == 1'b1) begin
        Logical_Operator_out1_1 <= 1'b0;
      end
      else begin
        if (enb) begin
          Logical_Operator_out1_1 <= Logical_Operator_out1;
        end
      end
    end

  assign switch_compare_1 = Logical_Operator_out1_1 > 1'b0;

  assign Constant_out1_re = 33'sh000000000;
  assign Constant_out1_im = 33'sh000000000;

  assign MovingSum_dataOut_re_1 = MovingSum_dataOut_re;

  assign MovingSum_dataOut_im_1 = MovingSum_dataOut_im;

  always @(posedge clk or posedge reset)
    begin : rd_2_process
      if (reset == 1'b1) begin
        for(rd_2_t_1 = 32'sd0; rd_2_t_1 <= 32'sd1; rd_2_t_1 = rd_2_t_1 + 32'sd1) begin
          rd_2_reg_re[rd_2_t_1] <= 33'sh000000000;
          rd_2_reg_im[rd_2_t_1] <= 33'sh000000000;
        end
      end
      else begin
        if (enb) begin
          for(rd_2_t_0_0 = 32'sd0; rd_2_t_0_0 <= 32'sd1; rd_2_t_0_0 = rd_2_t_0_0 + 32'sd1) begin
            rd_2_reg_re[rd_2_t_0_0] <= rd_2_reg_next_re[rd_2_t_0_0];
            rd_2_reg_im[rd_2_t_0_0] <= rd_2_reg_next_im[rd_2_t_0_0];
          end
        end
      end
    end

  assign MovingSum_dataOut_re_2 = rd_2_reg_re[1];
  assign MovingSum_dataOut_im_2 = rd_2_reg_im[1];
  assign rd_2_reg_next_re[0] = MovingSum_dataOut_re_1;
  assign rd_2_reg_next_im[0] = MovingSum_dataOut_im_1;
  assign rd_2_reg_next_re[1] = rd_2_reg_re[0];
  assign rd_2_reg_next_im[1] = rd_2_reg_im[0];

  assign Switch_out1_re = (switch_compare_1 == 1'b0 ? Constant_out1_re :
              MovingSum_dataOut_re_2);
  assign Switch_out1_im = (switch_compare_1 == 1'b0 ? Constant_out1_im :
              MovingSum_dataOut_im_2);

  always @(posedge clk or posedge reset)
    begin : rd_4_process
      if (reset == 1'b1) begin
        Switch_out1_re_1 <= 33'sh000000000;
        Switch_out1_im_1 <= 33'sh000000000;
      end
      else begin
        if (enb) begin
          Switch_out1_re_1 <= Switch_out1_re;
          Switch_out1_im_1 <= Switch_out1_im;
        end
      end
    end

  assign Shift_Arithmetic_out1_re = Switch_out1_re_1 >>> 8'd4;
  assign Shift_Arithmetic_out1_im = Switch_out1_im_1 >>> 8'd4;

  MagnitudeSquared u_MagnitudeSquared (.clk(clk),
                                       .reset(reset),
                                       .enb_1_8_1(enb_1_8_1),
                                       .enb_1_8_0(enb_1_8_0),
                                       .enb(enb),
                                       .dataIn_re(Shift_Arithmetic_out1_re),  // sfix33_En26
                                       .dataIn_im(Shift_Arithmetic_out1_im),  // sfix33_En26
                                       .validIn(Logical_Operator_out1),
                                       .dataOut(MagnitudeSquared_dataOut),  // sfix66_En52
                                       .validOut(MagnitudeSquared_validOut)
                                       );

  always @(posedge clk or posedge reset)
    begin : crp_out_delay_process
      if (reset == 1'b1) begin
        MagnitudeSquared_dataOut_1 <= 66'sh00000000000000000;
      end
      else begin
        if (enb) begin
          MagnitudeSquared_dataOut_1 <= MagnitudeSquared_dataOut;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay1_output_process
      if (reset == 1'b1) begin
        MagnitudeSquared_dataOut_2 <= 66'sh00000000000000000;
      end
      else begin
        if (enb_1_8_1) begin
          MagnitudeSquared_dataOut_2 <= MagnitudeSquared_dataOut_1;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay_process
      if (reset == 1'b1) begin
        Delay_out1 <= 66'sh00000000000000000;
      end
      else begin
        if (enb_1_8_0) begin
          Delay_out1 <= MagnitudeSquared_dataOut_2;
        end
      end
    end

  assign dataOut = Delay_out1;

  assign MagnitudeSquared_validOut_1 = MagnitudeSquared_validOut;

  always @(posedge clk or posedge reset)
    begin : Delay31_output_process
      if (reset == 1'b1) begin
        MagnitudeSquared_validOut_2 <= 1'b0;
      end
      else begin
        if (enb_1_8_1) begin
          MagnitudeSquared_validOut_2 <= MagnitudeSquared_validOut_1;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay3_process
      if (reset == 1'b1) begin
        Delay3_reg <= {2{1'b0}};
      end
      else begin
        if (enb_1_8_0) begin
          Delay3_reg[0] <= MagnitudeSquared_validOut_2;
          Delay3_reg[1] <= Delay3_reg[0];
        end
      end
    end

  assign Delay3_out1 = Delay3_reg[1];

  assign validOut = Delay3_out1;

endmodule  // Correlator_block

