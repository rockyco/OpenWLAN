// -------------------------------------------------------------
// 
// File Name: hdl_prj/hdlsrc/wlanhdlTimeAndFrequencySynchronization/WLANTimeAndFrequencySynchronization.v
// Created: 2026-02-04 22:38:44
// 
// Generated by MATLAB 25.1, HDL Coder 25.1, and Simulink 25.1
// 
// 
// -- -------------------------------------------------------------
// -- Rate and Clocking Details
// -- -------------------------------------------------------------
// Model base rate: 6.25e-09
// Target subsystem base rate: 6.25e-09
// 
// 
// Clock Enable  Sample Time
// -- -------------------------------------------------------------
// ce_out        5e-08
// -- -------------------------------------------------------------
// 
// 
// Output Signal                 Clock Enable  Sample Time
// -- -------------------------------------------------------------
// dataOut_re                    ce_out        5e-08
// dataOut_im                    ce_out        5e-08
// validOut                      ce_out        5e-08
// syncPulse                     ce_out        5e-08
// freqOff                       ce_out        5e-08
// freqOffValid                  ce_out        5e-08
// numPacketsDetected            ce_out        5e-08
// -- -------------------------------------------------------------
// 
// -------------------------------------------------------------


// -------------------------------------------------------------
// 
// Module: WLANTimeAndFrequencySynchronization
// Source Path: wlanhdlTimeAndFrequencySynchronization/WLANTimeAndFrequencySynchronization
// Hierarchy Level: 0
// Model version: 9.2
// 
// -------------------------------------------------------------

`timescale 1 ns / 1 ns

module WLANTimeAndFrequencySynchronization
          (clk,
           reset,
           clk_enable,
           dataIn_re,
           dataIn_im,
           validIn,
           startIn,
           ce_out,
           dataOut_re,
           dataOut_im,
           validOut,
           syncPulse,
           freqOff,
           freqOffValid,
           numPacketsDetected);


  input   clk;
  input   reset;
  input   clk_enable;
  input   signed [15:0] dataIn_re;  // sfix16_En12
  input   signed [15:0] dataIn_im;  // sfix16_En12
  input   validIn;
  input   startIn;
  output  ce_out;
  output  signed [15:0] dataOut_re;  // sfix16_En12
  output  signed [15:0] dataOut_im;  // sfix16_En12
  output  validOut;
  output  syncPulse;
  output  signed [34:0] freqOff;  // sfix35_En33
  output  freqOffValid;
  output  [15:0] numPacketsDetected;  // uint16


  wire enb_1_8_1;
  wire enb_1_8_0;
  wire enb;
  wire enb_1_1_1;
  reg signed [15:0] Delay3_out1_re;  // sfix16_En12
  reg signed [15:0] Delay3_out1_im;  // sfix16_En12
  reg  Delay2_out1;
  reg  Delay1_out1;
  wire signed [15:0] dataOut_re_1;  // sfix16_En12
  wire signed [15:0] dataOut_im_1;  // sfix16_En12
  wire Rx_Filter_validOut;
  wire Rx_Filter_startOut;
  wire signed [15:0] dataOut_re_2;  // sfix16_En12
  wire signed [15:0] dataOut_im_2;  // sfix16_En12
  wire Coarse_Time_Sync_validOut;
  wire Coarse_Time_Sync_lstfStart;
  wire Coarse_Time_Sync_rst;
  wire signed [33:0] Coarse_CFO_Estimation_and_Correction_Freq;  // sfix34_En33
  wire signed [15:0] dataOut_re_3;  // sfix16_En12
  wire signed [15:0] dataOut_im_3;  // sfix16_En12
  wire Coarse_CFO_Estimation_and_Correction_validOut;
  wire Coarse_CFO_Estimation_and_Correction_lstfStartOut;
  wire Coarse_CFO_Estimation_and_Correction_rstOut;
  wire signed [15:0] dataOut_re_4;  // sfix16_En12
  wire signed [15:0] dataOut_im_4;  // sfix16_En12
  wire Fine_Time_Sync_validOut;
  wire Fine_Time_Sync_Lstf_start;
  wire Fine_Time_Sync_rstOut;
  wire signed [33:0] Fine_CFO_Estimation_and_Correction_Freq;  // sfix34_En33
  wire Fine_CFO_Estimation_and_Correction_freqValidOut;
  wire Fine_CFO_Estimation_and_Correction_validOut;
  wire Fine_CFO_Estimation_and_Correction_lstfStartOut;
  wire signed [33:0] Coarse_CFO_Estimation_and_Correction_Freq_1;  // sfix34_En33
  wire signed [33:0] Fine_CFO_Estimation_and_Correction_Freq_1;  // sfix34_En33
  wire signed [34:0] Add_add_cast;  // sfix35_En33
  wire signed [34:0] Add_add_cast_1;  // sfix35_En33
  wire signed [34:0] Add_out1;  // sfix35_En33
  reg signed [34:0] t_bypass_reg;  // sfix35
  wire signed [34:0] Add_out1_1;  // sfix35_En33
  wire Fine_CFO_Estimation_and_Correction_lstfStartOut_1;
  reg  [2:0] rd_1_reg;  // ufix1 [3]
  wire Fine_CFO_Estimation_and_Correction_lstfStartOut_2;
  wire [15:0] count_step;  // uint16
  wire [15:0] count_from;  // uint16
  reg [15:0] HDL_Counter_out1;  // uint16
  wire [15:0] count;  // uint16
  reg [15:0] count_1;  // uint16
  wire need_to_wrap;
  reg  need_to_wrap_1;
  wire [15:0] count_value;  // uint16
  reg [15:0] count_value_1;  // uint16
  wire [15:0] HDL_Counter_out1_1;  // uint16
  wire [15:0] HDL_Counter_out1_2;  // uint16
  reg [15:0] rd_2_reg [0:1];  // ufix16 [2]
  wire [15:0] rd_2_reg_next [0:1];  // ufix16 [2]
  wire [15:0] HDL_Counter_out1_3;  // uint16
  wire [15:0] count_2;  // uint16
  reg [15:0] count_3;  // uint16
  reg [15:0] HDL_Counter_bypass_reg;  // ufix16
  reg signed [31:0] rd_2_t_0_0;  // int32
  reg signed [31:0] rd_2_t_1;  // int32


  WLANTimeAndFrequencySynchronization_tc u_WLANTimeAndFrequencySynchronization_tc (.clk(clk),
                                                                                   .reset(reset),
                                                                                   .clk_enable(clk_enable),
                                                                                   .enb(enb),
                                                                                   .enb_1_1_1(enb_1_1_1),
                                                                                   .enb_1_8_0(enb_1_8_0),
                                                                                   .enb_1_8_1(enb_1_8_1)
                                                                                   );

  always @(posedge clk or posedge reset)
    begin : Delay3_process
      if (reset == 1'b1) begin
        Delay3_out1_re <= 16'sb0000000000000000;
        Delay3_out1_im <= 16'sb0000000000000000;
      end
      else begin
        if (enb_1_8_0) begin
          Delay3_out1_re <= dataIn_re;
          Delay3_out1_im <= dataIn_im;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay2_process
      if (reset == 1'b1) begin
        Delay2_out1 <= 1'b0;
      end
      else begin
        if (enb_1_8_0) begin
          Delay2_out1 <= validIn;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : Delay1_process
      if (reset == 1'b1) begin
        Delay1_out1 <= 1'b0;
      end
      else begin
        if (enb_1_8_0) begin
          Delay1_out1 <= startIn;
        end
      end
    end

  Rx_Filter u_Rx_Filter (.clk(clk),
                         .reset(reset),
                         .enb_1_8_0(enb_1_8_0),
                         .dataIn_re(Delay3_out1_re),  // sfix16_En12
                         .dataIn_im(Delay3_out1_im),  // sfix16_En12
                         .validIn(Delay2_out1),
                         .startIn(Delay1_out1),
                         .dataOut_re(dataOut_re_1),  // sfix16_En12
                         .dataOut_im(dataOut_im_1),  // sfix16_En12
                         .validOut(Rx_Filter_validOut),
                         .startOut(Rx_Filter_startOut)
                         );

  Coarse_Time_Sync u_Coarse_Time_Sync (.clk(clk),
                                       .reset(reset),
                                       .enb_1_8_1(enb_1_8_1),
                                       .enb_1_8_0(enb_1_8_0),
                                       .enb(enb),
                                       .dataIn_re(dataOut_re_1),  // sfix16_En12
                                       .dataIn_im(dataOut_im_1),  // sfix16_En12
                                       .validIn(Rx_Filter_validOut),
                                       .startIn(Rx_Filter_startOut),
                                       .dataOut_re(dataOut_re_2),  // sfix16_En12
                                       .dataOut_im(dataOut_im_2),  // sfix16_En12
                                       .validOut(Coarse_Time_Sync_validOut),
                                       .lstfStart(Coarse_Time_Sync_lstfStart),
                                       .rst(Coarse_Time_Sync_rst)
                                       );

  Coarse_CFO_Estimation_and_Correction u_Coarse_CFO_Estimation_and_Correction (.clk(clk),
                                                                               .reset(reset),
                                                                               .enb_1_8_1(enb_1_8_1),
                                                                               .enb_1_8_0(enb_1_8_0),
                                                                               .enb(enb),
                                                                               .dataIn_re(dataOut_re_2),  // sfix16_En12
                                                                               .dataIn_im(dataOut_im_2),  // sfix16_En12
                                                                               .validIn(Coarse_Time_Sync_validOut),
                                                                               .LSTF_start(Coarse_Time_Sync_lstfStart),
                                                                               .rstIn(Coarse_Time_Sync_rst),
                                                                               .Freq(Coarse_CFO_Estimation_and_Correction_Freq),  // sfix34_En33
                                                                               .dataOut_re(dataOut_re_3),  // sfix16_En12
                                                                               .dataOut_im(dataOut_im_3),  // sfix16_En12
                                                                               .validOut(Coarse_CFO_Estimation_and_Correction_validOut),
                                                                               .lstfStartOut(Coarse_CFO_Estimation_and_Correction_lstfStartOut),
                                                                               .rstOut(Coarse_CFO_Estimation_and_Correction_rstOut)
                                                                               );

  Fine_Time_Sync u_Fine_Time_Sync (.clk(clk),
                                   .reset(reset),
                                   .enb_1_8_1(enb_1_8_1),
                                   .enb_1_8_0(enb_1_8_0),
                                   .enb(enb),
                                   .enb_1_1_1(enb_1_1_1),
                                   .dataIn_re(dataOut_re_3),  // sfix16_En12
                                   .dataIn_im(dataOut_im_3),  // sfix16_En12
                                   .validIn(Coarse_CFO_Estimation_and_Correction_validOut),
                                   .lstfStart(Coarse_CFO_Estimation_and_Correction_lstfStartOut),
                                   .rstIn(Coarse_CFO_Estimation_and_Correction_rstOut),
                                   .dataOut_re(dataOut_re_4),  // sfix16_En12
                                   .dataOut_im(dataOut_im_4),  // sfix16_En12
                                   .validOut(Fine_Time_Sync_validOut),
                                   .Lstf_start(Fine_Time_Sync_Lstf_start),
                                   .rstOut(Fine_Time_Sync_rstOut)
                                   );

  Fine_CFO_Estimation_and_Correction u_Fine_CFO_Estimation_and_Correction (.clk(clk),
                                                                           .reset(reset),
                                                                           .enb_1_8_1(enb_1_8_1),
                                                                           .enb_1_8_0(enb_1_8_0),
                                                                           .enb(enb),
                                                                           .dataIn_re(dataOut_re_4),  // sfix16_En12
                                                                           .dataIn_im(dataOut_im_4),  // sfix16_En12
                                                                           .validIn(Fine_Time_Sync_validOut),
                                                                           .LSTF_start(Fine_Time_Sync_Lstf_start),
                                                                           .rstIn(Fine_Time_Sync_rstOut),
                                                                           .Freq(Fine_CFO_Estimation_and_Correction_Freq),  // sfix34_En33
                                                                           .freqValidOut(Fine_CFO_Estimation_and_Correction_freqValidOut),
                                                                           .dataOut_re(dataOut_re),  // sfix16_En12
                                                                           .dataOut_im(dataOut_im),  // sfix16_En12
                                                                           .validOut(Fine_CFO_Estimation_and_Correction_validOut),
                                                                           .lstfStartOut(Fine_CFO_Estimation_and_Correction_lstfStartOut)
                                                                           );

  assign validOut = Fine_CFO_Estimation_and_Correction_validOut;

  assign syncPulse = Fine_CFO_Estimation_and_Correction_lstfStartOut;

  assign Coarse_CFO_Estimation_and_Correction_Freq_1 = Coarse_CFO_Estimation_and_Correction_Freq;

  assign Fine_CFO_Estimation_and_Correction_Freq_1 = Fine_CFO_Estimation_and_Correction_Freq;

  assign Add_add_cast = {Coarse_CFO_Estimation_and_Correction_Freq_1[33], Coarse_CFO_Estimation_and_Correction_Freq_1};
  assign Add_add_cast_1 = {Fine_CFO_Estimation_and_Correction_Freq_1[33], Fine_CFO_Estimation_and_Correction_Freq_1};
  assign Add_out1 = Add_add_cast + Add_add_cast_1;

  always @(posedge clk or posedge reset)
    begin : t_bypass_process
      if (reset == 1'b1) begin
        t_bypass_reg <= 35'sh000000000;
      end
      else begin
        if (enb_1_8_1) begin
          t_bypass_reg <= Add_out1;
        end
      end
    end

  assign Add_out1_1 = (enb_1_8_1 == 1'b1 ? Add_out1 :
              t_bypass_reg);

  assign freqOff = Add_out1_1;

  assign freqOffValid = Fine_CFO_Estimation_and_Correction_freqValidOut;

  assign Fine_CFO_Estimation_and_Correction_lstfStartOut_1 = Fine_CFO_Estimation_and_Correction_lstfStartOut;

  always @(posedge clk or posedge reset)
    begin : rd_1_process
      if (reset == 1'b1) begin
        rd_1_reg <= {3{1'b0}};
      end
      else begin
        if (enb) begin
          rd_1_reg[0] <= Fine_CFO_Estimation_and_Correction_lstfStartOut_1;
          rd_1_reg[32'sd2:32'sd1] <= rd_1_reg[32'sd1:32'sd0];
        end
      end
    end

  assign Fine_CFO_Estimation_and_Correction_lstfStartOut_2 = rd_1_reg[2];

  // Count limited, Unsigned Counter
  //  initial value   = 0
  //  step value      = 1
  //  count to value  = 65535
  assign count_step = 16'b0000000000000001;

  assign count_from = 16'b0000000000000000;

  assign count = HDL_Counter_out1 + count_step;

  always @(posedge clk or posedge reset)
    begin : rd_4_process
      if (reset == 1'b1) begin
        count_1 <= 16'b0000000000000000;
      end
      else begin
        if (enb) begin
          count_1 <= count;
        end
      end
    end

  assign need_to_wrap = HDL_Counter_out1 == 16'b1111111111111111;

  always @(posedge clk or posedge reset)
    begin : rd_3_process
      if (reset == 1'b1) begin
        need_to_wrap_1 <= 1'b0;
      end
      else begin
        if (enb) begin
          need_to_wrap_1 <= need_to_wrap;
        end
      end
    end

  assign count_value = (need_to_wrap_1 == 1'b0 ? count_1 :
              count_from);

  always @(posedge clk or posedge reset)
    begin : rd_5_process
      if (reset == 1'b1) begin
        count_value_1 <= 16'b0000000000000000;
      end
      else begin
        if (enb) begin
          count_value_1 <= count_value;
        end
      end
    end

  assign HDL_Counter_out1_2 = HDL_Counter_out1_1;

  always @(posedge clk or posedge reset)
    begin : rd_0_process
      if (reset == 1'b1) begin
        HDL_Counter_out1 <= 16'b0000000000000000;
      end
      else begin
        if (enb) begin
          HDL_Counter_out1 <= HDL_Counter_out1_2;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : rd_2_process
      if (reset == 1'b1) begin
        for(rd_2_t_1 = 32'sd0; rd_2_t_1 <= 32'sd1; rd_2_t_1 = rd_2_t_1 + 32'sd1) begin
          rd_2_reg[rd_2_t_1] <= 16'b0000000000000000;
        end
      end
      else begin
        if (enb) begin
          for(rd_2_t_0_0 = 32'sd0; rd_2_t_0_0 <= 32'sd1; rd_2_t_0_0 = rd_2_t_0_0 + 32'sd1) begin
            rd_2_reg[rd_2_t_0_0] <= rd_2_reg_next[rd_2_t_0_0];
          end
        end
      end
    end

  assign HDL_Counter_out1_3 = rd_2_reg[1];
  assign rd_2_reg_next[0] = HDL_Counter_out1;
  assign rd_2_reg_next[1] = rd_2_reg[0];

  assign count_2 = (Fine_CFO_Estimation_and_Correction_lstfStartOut_2 == 1'b0 ? HDL_Counter_out1_3 :
              count_value_1);

  always @(posedge clk or posedge reset)
    begin : crp_out_delay_process
      if (reset == 1'b1) begin
        count_3 <= 16'b0000000000000000;
      end
      else begin
        if (enb) begin
          count_3 <= count_2;
        end
      end
    end

  always @(posedge clk or posedge reset)
    begin : HDL_Counter_bypass_process
      if (reset == 1'b1) begin
        HDL_Counter_bypass_reg <= 16'b0000000000000000;
      end
      else begin
        if (enb_1_8_1) begin
          HDL_Counter_bypass_reg <= count_3;
        end
      end
    end

  assign HDL_Counter_out1_1 = (enb_1_8_1 == 1'b1 ? count_3 :
              HDL_Counter_bypass_reg);

  assign numPacketsDetected = HDL_Counter_out1_1;

  assign ce_out = enb_1_8_1;

endmodule  // WLANTimeAndFrequencySynchronization

