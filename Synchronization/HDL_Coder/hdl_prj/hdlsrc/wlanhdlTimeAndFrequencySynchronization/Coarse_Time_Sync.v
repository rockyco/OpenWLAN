// -------------------------------------------------------------
// 
// File Name: hdl_prj/hdlsrc/wlanhdlTimeAndFrequencySynchronization/Coarse_Time_Sync.v
// Created: 2026-02-04 22:38:43
// 
// Generated by MATLAB 25.1, HDL Coder 25.1, and Simulink 25.1
// 
// -------------------------------------------------------------


// -------------------------------------------------------------
// 
// Module: Coarse_Time_Sync
// Source Path: wlanhdlTimeAndFrequencySynchronization/WLANTimeAndFrequencySynchronization/Coarse Time Sync
// Hierarchy Level: 1
// Model version: 9.2
// 
// -------------------------------------------------------------

`timescale 1 ns / 1 ns

module Coarse_Time_Sync
          (clk,
           reset,
           enb_1_8_1,
           enb_1_8_0,
           enb,
           dataIn_re,
           dataIn_im,
           validIn,
           startIn,
           dataOut_re,
           dataOut_im,
           validOut,
           lstfStart,
           rst);


  input   clk;
  input   reset;
  input   enb_1_8_1;
  input   enb_1_8_0;
  input   enb;
  input   signed [15:0] dataIn_re;  // sfix16_En12
  input   signed [15:0] dataIn_im;  // sfix16_En12
  input   validIn;
  input   startIn;
  output  signed [15:0] dataOut_re;  // sfix16_En12
  output  signed [15:0] dataOut_im;  // sfix16_En12
  output  validOut;
  output  lstfStart;
  output  rst;


  wire signed [65:0] Correlator_dataOut;  // sfix66_En52
  wire Correlator_validOut;
  wire signed [65:0] Energy_Calculator_corrOut;  // sfix66_En52
  wire signed [70:0] Energy_Calculator_energyOut;  // sfix71_En54
  wire Energy_Calculator_validOut;
  reg signed [15:0] Delay4_reg_re [0:6];  // sfix16_En12 [7]
  reg signed [15:0] Delay4_reg_im [0:6];  // sfix16_En12 [7]
  reg signed [15:0] Delay4_reg_next_re [0:6];  // sfix16_En12 [7]
  reg signed [15:0] Delay4_reg_next_im [0:6];  // sfix16_En12 [7]
  reg signed [15:0] Delay4_out1_re;  // sfix16_En12
  reg signed [15:0] Delay4_out1_im;  // sfix16_En12
  reg  [6:0] Delay6_reg;  // ufix1 [7]
  wire Delay6_out1;
  wire signed [15:0] Stream_Synchronizer_dataOut_re;  // sfix16_En12
  wire signed [15:0] Stream_Synchronizer_dataOut_im;  // sfix16_En12
  wire Stream_Synchronizer_validOut;
  wire Peak_Detector_lstfStart;
  wire Peak_Detector_validOut;
  reg signed [31:0] Delay4_t_0_0;  // int32
  reg signed [31:0] Delay4_t_0_1;  // int32
  reg signed [31:0] Delay4_t_1;  // int32


  Correlator_block u_Correlator (.clk(clk),
                                 .reset(reset),
                                 .enb_1_8_1(enb_1_8_1),
                                 .enb_1_8_0(enb_1_8_0),
                                 .enb(enb),
                                 .dataIn_re(dataIn_re),  // sfix16_En12
                                 .dataIn_im(dataIn_im),  // sfix16_En12
                                 .validIn(validIn),
                                 .startIn(startIn),
                                 .dataOut(Correlator_dataOut),  // sfix66_En52
                                 .validOut(Correlator_validOut)
                                 );

  Energy_Calculator u_Energy_Calculator (.clk(clk),
                                         .reset(reset),
                                         .enb_1_8_1(enb_1_8_1),
                                         .enb_1_8_0(enb_1_8_0),
                                         .enb(enb),
                                         .corrIn(Correlator_dataOut),  // sfix66_En52
                                         .corrValidIn(Correlator_validOut),
                                         .dataIn_re(dataIn_re),  // sfix16_En12
                                         .dataIn_im(dataIn_im),  // sfix16_En12
                                         .validIn(validIn),
                                         .corrOut(Energy_Calculator_corrOut),  // sfix66_En52
                                         .energyOut(Energy_Calculator_energyOut),  // sfix71_En54
                                         .validOut(Energy_Calculator_validOut)
                                         );

  always @(posedge clk or posedge reset)
    begin : Delay4_process
      if (reset == 1'b1) begin
        for(Delay4_t_1 = 32'sd0; Delay4_t_1 <= 32'sd6; Delay4_t_1 = Delay4_t_1 + 32'sd1) begin
          Delay4_reg_re[Delay4_t_1] <= 16'sb0000000000000000;
          Delay4_reg_im[Delay4_t_1] <= 16'sb0000000000000000;
        end
      end
      else begin
        if (enb_1_8_0) begin
          for(Delay4_t_0_1 = 32'sd0; Delay4_t_0_1 <= 32'sd6; Delay4_t_0_1 = Delay4_t_0_1 + 32'sd1) begin
            Delay4_reg_re[Delay4_t_0_1] <= Delay4_reg_next_re[Delay4_t_0_1];
            Delay4_reg_im[Delay4_t_0_1] <= Delay4_reg_next_im[Delay4_t_0_1];
          end
        end
      end
    end

  always @* begin
    Delay4_out1_re = Delay4_reg_re[6];
    Delay4_out1_im = Delay4_reg_im[6];
    Delay4_reg_next_re[0] = dataIn_re;
    Delay4_reg_next_im[0] = dataIn_im;

    for(Delay4_t_0_0 = 32'sd0; Delay4_t_0_0 <= 32'sd5; Delay4_t_0_0 = Delay4_t_0_0 + 32'sd1) begin
      Delay4_reg_next_re[Delay4_t_0_0 + 32'sd1] = Delay4_reg_re[Delay4_t_0_0];
      Delay4_reg_next_im[Delay4_t_0_0 + 32'sd1] = Delay4_reg_im[Delay4_t_0_0];
    end

  end

  always @(posedge clk or posedge reset)
    begin : Delay6_process
      if (reset == 1'b1) begin
        Delay6_reg <= {7{1'b0}};
      end
      else begin
        if (enb_1_8_0) begin
          Delay6_reg[0] <= validIn;
          Delay6_reg[32'sd6:32'sd1] <= Delay6_reg[32'sd5:32'sd0];
        end
      end
    end

  assign Delay6_out1 = Delay6_reg[6];

  Stream_Synchronizer u_Stream_Synchronizer (.clk(clk),
                                             .reset(reset),
                                             .enb_1_8_1(enb_1_8_1),
                                             .enb_1_8_0(enb_1_8_0),
                                             .enb(enb),
                                             .corrValid(Correlator_validOut),
                                             .dataIn_re(Delay4_out1_re),  // sfix16_En12
                                             .dataIn_im(Delay4_out1_im),  // sfix16_En12
                                             .dataValid(Delay6_out1),
                                             .dataOut_re(Stream_Synchronizer_dataOut_re),  // sfix16_En12
                                             .dataOut_im(Stream_Synchronizer_dataOut_im),  // sfix16_En12
                                             .validOut(Stream_Synchronizer_validOut)
                                             );

  Peak_Detector u_Peak_Detector (.clk(clk),
                                 .reset(reset),
                                 .enb_1_8_1(enb_1_8_1),
                                 .enb_1_8_0(enb_1_8_0),
                                 .enb(enb),
                                 .corrIn(Energy_Calculator_corrOut),  // sfix66_En52
                                 .energyIn(Energy_Calculator_energyOut),  // sfix71_En54
                                 .corrValid(Energy_Calculator_validOut),
                                 .dataIn_re(Stream_Synchronizer_dataOut_re),  // sfix16_En12
                                 .dataIn_im(Stream_Synchronizer_dataOut_im),  // sfix16_En12
                                 .dataValid(Stream_Synchronizer_validOut),
                                 .lstfStart(Peak_Detector_lstfStart),
                                 .validOut(Peak_Detector_validOut),
                                 .dataOut_re(dataOut_re),  // sfix16_En12
                                 .dataOut_im(dataOut_im)  // sfix16_En12
                                 );

  assign validOut = Peak_Detector_validOut;

  assign lstfStart = Peak_Detector_lstfStart;

  assign rst = startIn;

endmodule  // Coarse_Time_Sync

