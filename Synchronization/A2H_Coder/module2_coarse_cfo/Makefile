# Makefile for HLS Project - Vitis 2024.2 (Fully Modernized v4.0)
# Modern Vitis Unified IDE with open_component command support
#
# MODERNIZATION v4.0 NOTES:
# - Uses open_component -reset ... -flow_target vivado for project creation
# - Enhanced GUI integration with direct HLS component recognition
# - Multiple GUI modes: workspace, waveform viewer, analysis view
# - Supports both classic (open_project) and modern (open_component) flows
# - Compatible with Vitis Unified IDE 2024.2 and later
#
# Usage: Run 'make help' for complete documentation

# Set the design name (to be customized per project)
DESIGN_NAME = module2_coarse_cfo

# Configuration variables (set to 1 to enable, 0 to disable)
CSIM = 1
CSYNTH = 1
COSIM = 1
EXPORT_IP = 1
VIVADO_IMPL = 1

# Hardware configuration
CLOCK_FREQ = 100
FPGA_PART = xc7z020clg400-1  # Zynq-7020 (per CLAUDE.md v28.2.0)
CLOCK_UNCERTAINTY = 12.5

# Vitis installation paths
VITIS_PATH ?= /opt/Xilinx/Vitis/2024.2
VITIS_HLS_PATH ?= /opt/Xilinx/Vitis_HLS/2024.2

# Xilinx license configuration
# Use absolute path for reliable license detection in all execution contexts
XILINX_LICENSE_FILE ?= /home/amd/.Xilinx/Xilinx.lic
export XILINXD_LICENSE_FILE = $(XILINX_LICENSE_FILE)

# Modern Vitis unified tool
HLS = $(VITIS_PATH)/bin/vitis-run --mode hls

# Project configuration
# Modern open_component creates component directory with component name
# Classic open_project creates proj_* directory
HLS_COMPONENT = $(DESIGN_NAME)
HLS_PROJECT = $(if $(PROJECT),$(PROJECT),proj_$(DESIGN_NAME))
HLS_SOLUTION = solution1

# C++ compiler and flags for standalone testbench
CXX = g++
CXXFLAGS = -Wall -Wextra -O2 -std=c++17
INCLUDES = -I$(VITIS_PATH)/include

# HLS compiler flags (e.g., -DPHASE6 for fixed-point mode)
HLS_CFLAGS ?=

# Source files
SRC_FILES = $(DESIGN_NAME).cpp
TB_FILES = $(DESIGN_NAME)_tb.cpp

# Test data directory and files
TEST_DATA_DIR = .
TEST_DATA_FILES := $(wildcard $(TEST_DATA_DIR)/*.txt) $(wildcard $(TEST_DATA_DIR)/*.dat)

# Target names
TB_EXE = $(DESIGN_NAME)_test
CONFIG_FILE = hls_config.cfg

# Calculate clock period in ns from MHz
CLOCK_PERIOD := $(shell echo "scale=2; 1000 / $(CLOCK_FREQ)" | bc)

.PHONY: all clean tb csim csynth cosim export_ip impl help report gui gui-wave gui-analyze gui-classic config quick full verify csim6 csynth6 cosim6 verify6

all: clean csim csynth

# ========================================
# Standalone testbench using GCC
# ========================================
tb:
	@echo "Building standalone testbench..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $(SRC_FILES) $(TB_FILES) -o $(TB_EXE)
	@echo "Running standalone testbench..."
	./$(TB_EXE)

# ========================================
# Generate HLS Config File (Modern Approach)
# ========================================
config:
	@echo "Generating HLS config file..."
	@echo "# Vitis HLS Configuration File" > $(CONFIG_FILE)
	@echo "# Generated by Makefile for $(DESIGN_NAME)" >> $(CONFIG_FILE)
	@echo "" >> $(CONFIG_FILE)
	@echo "[hls]" >> $(CONFIG_FILE)
	@echo "" >> $(CONFIG_FILE)
	@echo "# Project settings" >> $(CONFIG_FILE)
	@echo "project=$(HLS_PROJECT)" >> $(CONFIG_FILE)
	@echo "solution=$(HLS_SOLUTION)" >> $(CONFIG_FILE)
	@echo "top=$(DESIGN_NAME)" >> $(CONFIG_FILE)
	@echo "" >> $(CONFIG_FILE)
	@echo "# Source files" >> $(CONFIG_FILE)
	@for file in $(SRC_FILES); do \
		echo "syn.file=$$file" >> $(CONFIG_FILE); \
	done
	@for file in $(TB_FILES); do \
		echo "tb.file=$$file" >> $(CONFIG_FILE); \
	done
	@for file in $(TEST_DATA_FILES); do \
		echo "tb.file=$$file" >> $(CONFIG_FILE); \
	done
	@echo "" >> $(CONFIG_FILE)
	@echo "# Hardware configuration" >> $(CONFIG_FILE)
	@echo "part=$(FPGA_PART)" >> $(CONFIG_FILE)
	@echo "clock=$(CLOCK_PERIOD)ns" >> $(CONFIG_FILE)
	@echo "clock.uncertainty=$(CLOCK_UNCERTAINTY)%" >> $(CONFIG_FILE)
	@echo "" >> $(CONFIG_FILE)
	@echo "# Synthesis configuration" >> $(CONFIG_FILE)
	@echo "syn.compile.pipeline_loops=1" >> $(CONFIG_FILE)
	@echo "syn.interface.m_axi_addr64=0" >> $(CONFIG_FILE)
	@echo "syn.rtl.reset=control" >> $(CONFIG_FILE)
	@echo "syn.dataflow.default_channel=fifo" >> $(CONFIG_FILE)
	@echo "syn.dataflow.fifo_depth=2" >> $(CONFIG_FILE)
	@echo ""
	@echo "✓ Config file generated: $(CONFIG_FILE)"

# ========================================
# HLS C Simulation (Modern open_component Flow)
# ========================================
csim:
ifeq ($(CSIM), 1)
	@echo "========================================="
	@echo "Running HLS C Simulation (Modern Flow)"
	@echo "========================================="
	@echo "# Modern Vitis HLS Flow using open_component" > csim.tcl
	@echo "open_component -reset $(DESIGN_NAME) -flow_target vivado" >> csim.tcl
	@echo "" >> csim.tcl
	@echo "# Add source files" >> csim.tcl
	@if [ -n "$(HLS_CFLAGS)" ]; then \
		for file in $(SRC_FILES); do \
			echo "add_files -cflags \"$(HLS_CFLAGS)\" $$file" >> csim.tcl; \
		done; \
	else \
		for file in $(SRC_FILES); do \
			echo "add_files $$file" >> csim.tcl; \
		done; \
	fi
	@echo "" >> csim.tcl
	@echo "# Add testbench files" >> csim.tcl
	@if [ -n "$(HLS_CFLAGS)" ]; then \
		echo "add_files -tb -cflags \"$(HLS_CFLAGS)\" $(TB_FILES)" >> csim.tcl; \
	else \
		echo "add_files -tb $(TB_FILES)" >> csim.tcl; \
	fi
	@for file in $(TEST_DATA_FILES); do \
		echo "add_files -tb $$file" >> csim.tcl; \
	done
	@echo "" >> csim.tcl
	@echo "# Set top function" >> csim.tcl
	@echo "set_top $(DESIGN_NAME)" >> csim.tcl
	@echo "" >> csim.tcl
	@echo "# Configure hardware" >> csim.tcl
	@echo "set_part {$(FPGA_PART)}" >> csim.tcl
	@echo "create_clock -period $(CLOCK_PERIOD)ns" >> csim.tcl
	@echo "set_clock_uncertainty $(CLOCK_UNCERTAINTY)%" >> csim.tcl
	@echo "" >> csim.tcl
	@echo "# Run C simulation" >> csim.tcl
	@echo "csim_design -clean" >> csim.tcl
	@echo "" >> csim.tcl
	@echo "exit" >> csim.tcl
	@XILINXD_LICENSE_FILE=$(XILINX_LICENSE_FILE) $(HLS) --tcl csim.tcl 2>&1 | tee csim.log; \
	if grep -aqE "ERROR:|Failed to load feature" csim.log; then \
		echo ""; \
		echo "✗ C Simulation FAILED (errors detected)"; \
		grep -aE "ERROR:|Failed to load feature" csim.log; \
		exit 1; \
	fi; \
	if grep -aq "CSim done with 0 errors" csim.log; then \
		echo "✓ C Simulation complete"; \
		echo "✓ HLS component created: $(DESIGN_NAME)"; \
	else \
		echo "✗ C Simulation FAILED"; \
		exit 1; \
	fi
endif

# ========================================
# HLS C Synthesis (Modern open_component Flow)
# ========================================
csynth:
ifeq ($(CSYNTH), 1)
	@echo "========================================="
	@echo "Running HLS C Synthesis (Modern Flow)"
	@echo "========================================="
	@echo "# Modern Vitis HLS Flow using open_component" > csynth.tcl
	@echo "open_component $(HLS_COMPONENT) -flow_target vivado" >> csynth.tcl
	@echo "" >> csynth.tcl
	@echo "# Configure hardware (required for synthesis)" >> csynth.tcl
	@echo "set_part {$(FPGA_PART)}" >> csynth.tcl
	@echo "create_clock -period $(CLOCK_PERIOD)ns" >> csynth.tcl
	@echo "" >> csynth.tcl
	@echo "# Run C synthesis" >> csynth.tcl
	@echo "csynth_design" >> csynth.tcl
	@echo "" >> csynth.tcl
	@echo "exit" >> csynth.tcl
	@XILINXD_LICENSE_FILE=$(XILINX_LICENSE_FILE) $(HLS) --tcl csynth.tcl 2>&1 | tee csynth.log; \
	if grep -aqE "ERROR:|Failed to load feature" csynth.log; then \
		echo ""; \
		echo "✗ C Synthesis FAILED (errors detected)"; \
		grep -aE "ERROR:|Failed to load feature" csynth.log; \
		exit 1; \
	fi; \
	if grep -aq "Finished Command csynth_design" csynth.log; then \
		echo "✓ C Synthesis complete"; \
	else \
		echo "✗ C Synthesis FAILED"; \
		exit 1; \
	fi
endif

# ========================================
# HLS C/RTL Co-simulation (Modern open_component Flow)
# ========================================
cosim:
ifeq ($(COSIM), 1)
	@echo "========================================="
	@echo "Running HLS C/RTL Co-simulation (Modern Flow)"
	@echo "========================================="
	@echo "# Modern Vitis HLS Flow using open_component" > cosim.tcl
	@echo "open_component $(HLS_COMPONENT) -flow_target vivado" >> cosim.tcl
	@echo "" >> cosim.tcl
	@echo "# Configure hardware (required for co-simulation)" >> cosim.tcl
	@echo "set_part {$(FPGA_PART)}" >> cosim.tcl
	@echo "create_clock -period $(CLOCK_PERIOD)ns" >> cosim.tcl
	@echo "" >> cosim.tcl
	@echo "# Add testbench files with COSIM_SMALL_DATASET preprocessor definition" >> cosim.tcl
	@echo "# (source files are already in component from csynth)" >> cosim.tcl
	@echo "add_files -tb -cflags \"-DCOSIM_SMALL_DATASET\" $(TB_FILES)" >> cosim.tcl
	@for file in $(TEST_DATA_FILES); do \
		echo "add_files -tb $$file" >> cosim.tcl; \
	done
	@echo "" >> cosim.tcl
	@echo "# Run C/RTL co-simulation" >> cosim.tcl
ifeq ($(COSIM_WAVE_DEBUG), 1)
	@echo "cosim_design -rtl verilog -trace_level all -wave_debug" >> cosim.tcl
else
	@echo "cosim_design -rtl verilog -trace_level all" >> cosim.tcl
endif
	@echo "" >> cosim.tcl
	@echo "exit" >> cosim.tcl
	@XILINXD_LICENSE_FILE=$(XILINX_LICENSE_FILE) $(HLS) --tcl cosim.tcl 2>&1 | tee cosim.log; \
	if grep -aqE "ERROR:|Failed to load feature" cosim.log; then \
		echo ""; \
		echo "✗ Co-simulation FAILED (errors detected)"; \
		grep -aE "ERROR:|Failed to load feature" cosim.log; \
		exit 1; \
	fi; \
	if grep -aq "Finished Command cosim_design" cosim.log; then \
		echo ""; \
		echo "✓ Co-simulation complete"; \
		echo "To view waveforms in Vitis GUI, run: make gui-wave"; \
	else \
		echo "✗ Co-simulation FAILED"; \
		exit 1; \
	fi
endif

# ========================================
# Export RTL as IP (Modern open_component Flow)
# ========================================
export_ip:
ifeq ($(EXPORT_IP), 1)
	@echo "========================================="
	@echo "Exporting IP (Modern Flow)"
	@echo "========================================="
	@echo "# Modern Vitis HLS Flow using open_component" > export.tcl
	@echo "open_component $(HLS_COMPONENT) -flow_target vivado" >> export.tcl
	@echo "" >> export.tcl
	@echo "# Configure hardware (required for export)" >> export.tcl
	@echo "set_part {$(FPGA_PART)}" >> export.tcl
	@echo "" >> export.tcl
	@echo "# Export design as Vivado IP" >> export.tcl
	@echo "export_design -format ip_catalog" >> export.tcl
	@echo "" >> export.tcl
	@echo "exit" >> export.tcl
	@XILINXD_LICENSE_FILE=$(XILINX_LICENSE_FILE) $(HLS) --tcl export.tcl 2>&1 | tee export.log; \
	if grep -aqE "ERROR:|Failed to load feature" export.log; then \
		echo ""; \
		echo "✗ IP Export FAILED (errors detected)"; \
		grep -aE "ERROR:|Failed to load feature" export.log; \
		exit 1; \
	fi; \
	if grep -aq "Finished Command export_design" export.log; then \
		echo "✓ IP export complete"; \
	else \
		echo "✗ IP Export FAILED"; \
		exit 1; \
	fi
endif

# ========================================
# Run Implementation in Vivado (Modern Flow)
# ========================================
impl:
ifeq ($(VIVADO_IMPL), 1)
	@echo "========================================="
	@echo "Running Vivado Implementation (Modern Flow)"
	@echo "========================================="
	@echo "# Modern Vitis HLS Flow using open_component" > impl.tcl
	@echo "open_component $(HLS_COMPONENT) -flow_target vivado" >> impl.tcl
	@echo "" >> impl.tcl
	@echo "# Configure hardware (required for implementation)" >> impl.tcl
	@echo "set_part {$(FPGA_PART)}" >> impl.tcl
	@echo "" >> impl.tcl
	@echo "# Export design for implementation (uses existing synthesis)" >> impl.tcl
	@echo "export_design -flow impl -rtl verilog -format ip_catalog" >> impl.tcl
	@echo "" >> impl.tcl
	@echo "exit" >> impl.tcl
	@XILINXD_LICENSE_FILE=$(XILINX_LICENSE_FILE) $(HLS) --tcl impl.tcl 2>&1 | tee impl.log; \
	if grep -aqE "ERROR:|Failed to load feature" impl.log; then \
		echo ""; \
		echo "✗ Implementation FAILED (errors detected)"; \
		grep -aE "ERROR:|Failed to load feature" impl.log; \
		exit 1; \
	fi; \
	if grep -aq "Finished Command export_design" impl.log; then \
		echo "✓ Implementation complete"; \
	else \
		echo "✗ Implementation FAILED"; \
		exit 1; \
	fi
endif

# ========================================
# Generate synthesis report summary
# ========================================
report:
	@echo "========================================="
	@echo "HLS Synthesis Report Summary"
	@echo "========================================="
	@if [ -f $(HLS_COMPONENT)/hls/syn/report/csynth.rpt ]; then \
		echo ""; \
		echo "Resource Utilization:"; \
		echo "-------------------"; \
		grep -A 15 "== Utilization Estimates" $(HLS_COMPONENT)/hls/syn/report/csynth.rpt | grep -E "Total|BRAM|DSP|FF|LUT|URAM|Available|Utilization" | head -10; \
		echo ""; \
		echo "Timing Information:"; \
		echo "------------------"; \
		grep -A 8 "== Performance Estimates" $(HLS_COMPONENT)/hls/syn/report/csynth.rpt | grep -E "Clock|Target|Estimated|Uncertainty" | head -6; \
		echo ""; \
		echo "Latency Information:"; \
		echo "-------------------"; \
		grep -A 10 "Latency (cycles)" $(HLS_COMPONENT)/hls/syn/report/csynth.rpt | grep -E "min|max|Latency|Interval|Pipeline" | head -10; \
		echo ""; \
		echo "Full report: $(HLS_COMPONENT)/hls/syn/report/csynth.rpt"; \
	else \
		echo "❌ Synthesis report not found. Run 'make csynth' first."; \
	fi

# ========================================
# GUI Support - Launch Vitis Unified IDE (Modern)
# ========================================
gui:
	@echo "Launching Vitis Unified IDE..."
	@if [ -z "$$DISPLAY" ]; then \
		echo ""; \
		echo "⚠️  WARNING: DISPLAY variable not set!"; \
		echo "Attempting to auto-detect X11 display..."; \
		if [ -d "/tmp/.X11-unix" ]; then \
			DETECTED_DISPLAY=$$(ls -1 /tmp/.X11-unix/ 2>/dev/null | sed 's/X/:/g' | head -1); \
			if [ -n "$$DETECTED_DISPLAY" ]; then \
				echo "✓ Found X11 display: $$DETECTED_DISPLAY"; \
				export DISPLAY=$$DETECTED_DISPLAY; \
			else \
				echo "❌ Error: No X11 displays found!"; \
				echo "Set DISPLAY manually or use VNC/remote desktop."; \
				exit 1; \
			fi; \
		else \
			echo "❌ Error: No X11 server detected!"; \
			exit 1; \
		fi; \
	fi
	@if [ -d "$(HLS_COMPONENT)" ]; then \
		echo "Opening HLS component: $(HLS_COMPONENT)"; \
		echo "Using: Vitis Unified IDE 2024.2"; \
		if [ -z "$$DISPLAY" ]; then \
			DISPLAY=$$(ls -1 /tmp/.X11-unix/ 2>/dev/null | sed 's/X/:/g' | head -1); \
			export DISPLAY; \
		fi; \
		echo "Initializing clean workspace..."; \
		rm -rf _ide 2>/dev/null || true; \
		rm -rf $(HLS_COMPONENT)/_ide 2>/dev/null || true; \
		echo "Creating workspace in current directory..."; \
		DISPLAY=$${DISPLAY} $(VITIS_PATH)/bin/vitis -w $(PWD) & \
		echo ""; \
		echo "=== Vitis Unified IDE Opened ==="; \
		echo "✓ Workspace: $(PWD)"; \
		echo "✓ HLS component will be auto-discovered: $(HLS_COMPONENT)"; \
		echo ""; \
		echo "In Vitis IDE:"; \
		echo "  1. Component Explorer → $(HLS_COMPONENT) will appear"; \
		echo "  2. Double-click to open component"; \
		echo "  3. Access Flow Navigator for HLS operations"; \
		echo "  4. View synthesis reports in Analysis view"; \
		echo ""; \
		echo "Or use quick commands:"; \
		echo "  make gui-wave     # Direct waveform viewer"; \
		echo "  make gui-analyze  # Analysis view with reports"; \
	else \
		echo "❌ Error: Component $(HLS_COMPONENT) not found!"; \
		echo "Run 'make csim' first to create the HLS component."; \
		exit 1; \
	fi

# ========================================
# GUI Support - Waveform Viewer (Direct Access)
# ========================================
gui-wave:
	@echo "Launching Vitis Waveform Viewer..."
	@if [ -z "$$DISPLAY" ]; then \
		DISPLAY=$$(ls -1 /tmp/.X11-unix/ 2>/dev/null | sed 's/X/:/g' | head -1); \
		export DISPLAY; \
	fi
	@WAVE_FILE=$$(find $(HLS_COMPONENT)/hls/sim -name "*.wdb" 2>/dev/null | head -1); \
	if [ -n "$$WAVE_FILE" ]; then \
		echo "Opening waveform: $$WAVE_FILE"; \
		DISPLAY=$${DISPLAY} $(VITIS_PATH)/bin/vitis -a "$$WAVE_FILE" & \
		echo "✓ Waveform viewer launched"; \
	else \
		echo "❌ Error: No waveform files found!"; \
		echo "Run 'make COSIM_WAVE_DEBUG=1 cosim' first to generate waveforms."; \
		exit 1; \
	fi

# ========================================
# GUI Support - Analysis View (Reports and Summary)
# ========================================
gui-analyze:
	@echo "Launching Vitis Analysis View..."
	@if [ -z "$$DISPLAY" ]; then \
		DISPLAY=$$(ls -1 /tmp/.X11-unix/ 2>/dev/null | sed 's/X/:/g' | head -1); \
		export DISPLAY; \
	fi
	@if [ -d "$(HLS_COMPONENT)/hls" ]; then \
		echo "Opening analysis view for: $(HLS_COMPONENT)"; \
		DISPLAY=$${DISPLAY} $(VITIS_PATH)/bin/vitis -a $(HLS_COMPONENT)/hls & \
		echo "✓ Analysis view launched"; \
		echo "✓ View synthesis reports, resource utilization, and performance metrics"; \
	else \
		echo "❌ Error: HLS directory not found!"; \
		echo "Run 'make csynth' first to generate synthesis reports."; \
		exit 1; \
	fi

# ========================================
# GUI Support - Classic Mode (Deprecated)
# ========================================
gui-classic:
	@echo "WARNING: Classic HLS GUI is deprecated and will be removed in future releases"
	@echo "Please use 'make gui' for the modern Vitis Unified IDE"
	@echo ""
	@if [ -z "$$DISPLAY" ]; then \
		echo "⚠️  WARNING: DISPLAY variable not set!"; \
		echo "Attempting to auto-detect X11 display..."; \
		if [ -d "/tmp/.X11-unix" ]; then \
			DETECTED_DISPLAY=$$(ls -1 /tmp/.X11-unix/ 2>/dev/null | sed 's/X/:/g' | head -1); \
			if [ -n "$$DETECTED_DISPLAY" ]; then \
				echo "✓ Found X11 display: $$DETECTED_DISPLAY"; \
				export DISPLAY=$$DETECTED_DISPLAY; \
			else \
				echo "❌ Error: No X11 displays found!"; \
				exit 1; \
			fi; \
		else \
			echo "❌ Error: No X11 server detected!"; \
			exit 1; \
		fi; \
	fi
	@echo "Launching Classic HLS GUI..."
	@if [ -d "$(HLS_PROJECT)" ]; then \
		echo "Opening project: $(HLS_PROJECT)"; \
		if [ -z "$$DISPLAY" ]; then \
			DISPLAY=$$(ls -1 /tmp/.X11-unix/ 2>/dev/null | sed 's/X/:/g' | head -1); \
			export DISPLAY; \
		fi; \
		(cd $(HLS_PROJECT) && DISPLAY=$${DISPLAY} $(VITIS_HLS_PATH)/bin/vitis_hls -classic -p . &); \
		echo "Classic HLS IDE launched"; \
	else \
		echo "❌ Error: Project $(HLS_PROJECT) not found!"; \
		exit 1; \
	fi

# ========================================
# Clean up
# ========================================
clean:
	@echo "Cleaning up..."
	rm -rf $(HLS_COMPONENT) $(HLS_PROJECT) *.dat *.log *.tcl $(TB_EXE) *.o *.out $(CONFIG_FILE)
	rm -rf *.wdb *.wcfg *.xml
	@echo "✓ Cleaned: component, project, logs, and temporary files"

# ========================================
# Help information
# ========================================
help:
	@echo "========================================="
	@echo "Makefile for HLS Project: $(DESIGN_NAME)"
	@echo "Vitis 2024.2 - Modernized v4.0"
	@echo "Modern open_component Flow with Enhanced GUI"
	@echo "========================================="
	@echo ""
	@echo "Usage:"
	@echo "  make [target] [DESIGN_NAME=<name>] [options]"
	@echo ""
	@echo "Main Targets:"
	@echo "  all          : Run C simulation and C synthesis (default)"
	@echo "  tb           : Build and run standalone testbench (optional)"
	@echo "  config       : Generate HLS config file (modern approach)"
	@echo "  csim         : Run HLS C simulation (creates HLS component)"
	@echo "  csynth       : Run HLS C synthesis"
	@echo "  cosim        : Run HLS C/RTL co-simulation"
	@echo "  export_ip    : Export RTL as Vivado IP catalog"
	@echo "  impl         : Run implementation in Vivado"
	@echo "  report       : Display synthesis report summary"
	@echo "  clean        : Clean up generated files"
	@echo "  help         : Display this help information"
	@echo ""
	@echo "GUI Targets (Modern Vitis Unified IDE 2024.2):"
	@echo "  gui          : Launch Unified IDE with HLS component (full workspace)"
	@echo "  gui-wave     : Launch Waveform Viewer directly (quick access)"
	@echo "  gui-analyze  : Launch Analysis View (reports and metrics)"
	@echo "  gui-classic  : Launch Classic HLS GUI (deprecated, backward compat)"
	@echo ""
	@echo "Quick Workflow Targets:"
	@echo "  quick        : csim + csynth + report"
	@echo "  verify       : csim + csynth + cosim + report"
	@echo "  full         : all + cosim + impl + report"
	@echo ""
	@echo "Phase 6 Targets (fixed-point mode with -DPHASE6):"
	@echo "  csim6        : C simulation with PHASE6 flag"
	@echo "  csynth6      : C synthesis with PHASE6 flag"
	@echo "  cosim6       : C/RTL co-simulation with PHASE6 flag"
	@echo "  verify6      : clean + csim6 + csynth6 + cosim6 + report"
	@echo ""
	@echo "Configuration (set to 1 to enable, 0 to disable):"
	@echo "  CSIM              = $(CSIM)  (C simulation)"
	@echo "  CSYNTH            = $(CSYNTH)  (C synthesis)"
	@echo "  COSIM             = $(COSIM)  (C/RTL co-simulation)"
	@echo "  COSIM_WAVE_DEBUG  = 0/1 (Enable detailed waveform debug)"
	@echo "  EXPORT_IP         = $(EXPORT_IP)  (Export IP)"
	@echo "  VIVADO_IMPL       = $(VIVADO_IMPL)  (Vivado implementation)"
	@echo ""
	@echo "Hardware Configuration:"
	@echo "  CLOCK_FREQ        = $(CLOCK_FREQ) MHz (Clock frequency)"
	@echo "  CLOCK_PERIOD      = $(CLOCK_PERIOD) ns (Clock period)"
	@echo "  FPGA_PART         = $(FPGA_PART)  (FPGA part)"
	@echo "  CLOCK_UNCERTAINTY = $(CLOCK_UNCERTAINTY)%  (Clock uncertainty)"
	@echo ""
	@echo "Modern HLS Flow (v4.0):"
	@echo "  ✓ Uses open_component -reset ... -flow_target vivado"
	@echo "  ✓ Component name: $(HLS_COMPONENT)"
	@echo "  ✓ Direct HLS component recognition in Unified IDE"
	@echo "  ✓ Multiple GUI modes: workspace, waveform, analysis"
	@echo "  ✓ Command-line HLS: $(HLS)"
	@echo ""
	@echo "GUI Options:"
	@echo "  Unified IDE (recommended): $(VITIS_PATH)/bin/vitis"
	@echo "  Classic HLS (deprecated):  $(VITIS_HLS_PATH)/bin/vitis_hls -classic"
	@echo "  Note: Auto-detects X11 display (ssh -X, VNC, or remote desktop)"
	@echo ""
	@echo "Examples:"
	@echo "  make all                                  # Run csim and csynth"
	@echo "  make CLOCK_FREQ=250 csynth                # Synthesize at 250MHz"
	@echo "  make COSIM_WAVE_DEBUG=1 cosim             # Run co-sim with waveforms"
	@echo "  make gui                                  # Launch unified IDE (full)"
	@echo "  make gui-wave                             # Quick waveform access"
	@echo "  make gui-analyze                          # View synthesis reports"
	@echo ""
	@echo "Typical Workflow:"
	@echo "  1. make clean && make csim                # Create HLS component + C sim"
	@echo "  2. make csynth                            # Run synthesis"
	@echo "  3. make COSIM_WAVE_DEBUG=1 cosim          # Run co-sim with waveforms"
	@echo "  4. make gui-wave                          # View waveforms directly"
	@echo "  OR make gui                               # Full IDE for all operations"
	@echo ""
	@echo "Framework: MATLAB2HLS v10.1.0"
	@echo "Makefile: v4.0 (Modern open_component Flow)"
	@echo "========================================="

# Quick targets for common operations
quick: csim csynth report

full: all cosim impl report

verify: csim csynth cosim report

# Phase 6 targets (fixed-point mode)
csim6:
	@$(MAKE) csim HLS_CFLAGS="-DPHASE6"

csynth6:
	@$(MAKE) csynth HLS_CFLAGS="-DPHASE6"

cosim6:
	@$(MAKE) cosim HLS_CFLAGS="-DPHASE6"

verify6: clean csim6 csynth6 cosim6 report
